base="$(cd "$(dirname "$0")/.."; pwd)";

rm -r build/*

mkdir -p build/skin/adminhtml/base/default/easycredit

version=$(php -r "echo current(simplexml_load_file('src/app/code/community/Netzkollektiv/EasyCredit/etc/config.xml')->modules)->version;")
echo "building v$version"

cp -r src/* build/
rsync -r --exclude index.html merchant-interface/dist/* build/skin/adminhtml/base/default/easycredit/
cp *.md build/ 
(cd build; tar cvf ext.tar *)

php ../MagentoTarToConnect/magento-tar-to-connect.php package-config.php 
# (cd build/ && zip -r - *) > dist/m1-easycredit-$version.zip

gzip build/ext.tar;
mv build/ext.tar.gz dist/m1-easycredit-$version.tar.gz
echo "created: m1-easycredit-$version.tar.gz"

exit;

# German docs
cd docs/sphinx-docs
rm build/latex/*.pdf
make latexpdf
make html
cd $base
cp docs/sphinx-docs/build/latex/m1-easycredit.pdf dist/

# English docs
cd docs/sphinx-docs-en
rm build/latex/*.pdf
make latexpdf
make html
cd $base
cp docs/sphinx-docs-en/build/latex/m1-easycredit-en.pdf dist/
